import{a as l}from"./chunk-74Y2S55E.js";import{Eb as g,Ka as u,Ma as m,b as h,d as i,j as a,l as p,o as c}from"./chunk-ZVV5SR7V.js";var $=(()=>{let r=class r{constructor(t,e){this.http=t,this.router=e,this.baseUrl=l.apiUrl,this.apiUrl=`${l.apiUrl}/api/v1/auth`,this.currentUserSubject=new h(JSON.parse(localStorage.getItem("user")||"{}")),this.currentUser=this.currentUserSubject.asObservable()}signIn(t,e){let n={email:t,password:e};return this.http.post(`${this.apiUrl}/authenticate`,n).pipe(a(o=>{o.access_token&&(localStorage.setItem("access_token",o.access_token),localStorage.setItem("refresh_token",o.refresh_token),localStorage.setItem("user",JSON.stringify(o.userUuid)),this.currentUserSubject.next(o.userUuid),this.router.navigate(["/auth/cover-login"]))}))}isTokenExpired(){let t=localStorage.getItem("access_token");if(!t)return!0;let n=JSON.parse(atob(t.split(".")[1])).exp*1e3;return new Date().getTime()>n}refreshToken(){let t=localStorage.getItem("access_token");return t?this.http.post(`${this.apiUrl}/refresh-token`,null,{headers:new u().set("Authorization",`Bearer ${t}`)}).pipe(a(e=>{e.token&&localStorage.setItem("access_token",e.token)})):i("No access token found")}getUserData(){let t=localStorage.getItem("access_token");return t?this.http.get(`${this.apiUrl}/user-data`,{headers:new u().set("Authorization",`Bearer ${t}`)}):i("No token found")}signUp(t){return this.http.post(`${this.apiUrl}/registerAdmin`,t)}logout(){localStorage.removeItem("user"),this.currentUserSubject.next(null),this.router.navigate(["/auth/signin"])}getUserProfile(){let t=localStorage.getItem("user");return t?(t=t.replace(/^"|"$/g,""),console.log(t),this.http.get(`${this.baseUrl}/utilisateurs/${t}`)):i("User ID not found in local storage")}};r.\u0275fac=function(e){return new(e||r)(c(m),c(g))},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{$ as a};
