import{Eb as g,Ka as u,Ma as p,b as l,d as s,j as n,l as h,o as c}from"./chunk-ZVV5SR7V.js";var U=(()=>{let r=class r{constructor(t,e){this.http=t,this.router=e,this.apiUrl="http://localhost:8080/api/v1/auth",this.currentUserSubject=new l(JSON.parse(localStorage.getItem("user")||"{}")),this.currentUser=this.currentUserSubject.asObservable()}signIn(t,e){let a={email:t,password:e};return this.http.post(`${this.apiUrl}/authenticate`,a).pipe(n(o=>{o.access_token&&(localStorage.setItem("access_token",o.access_token),localStorage.setItem("refresh_token",o.refresh_token),localStorage.setItem("user",JSON.stringify(o.userUuid)),this.currentUserSubject.next(o.userUuid),this.router.navigate(["/auth/cover-login"]))}))}isTokenExpired(){let t=localStorage.getItem("access_token");if(!t)return!0;let a=JSON.parse(atob(t.split(".")[1])).exp*1e3;return new Date().getTime()>a}refreshToken(){let t=localStorage.getItem("access_token");return t?this.http.post(`${this.apiUrl}/refresh-token`,null,{headers:new u().set("Authorization",`Bearer ${t}`)}).pipe(n(e=>{e.token&&localStorage.setItem("access_token",e.token)})):s("No access token found")}getUserData(){let t=localStorage.getItem("access_token");return t?this.http.get(`${this.apiUrl}/user-data`,{headers:new u().set("Authorization",`Bearer ${t}`)}):s("No token found")}signUp(t){return this.http.post(`${this.apiUrl}/register`,t)}logout(){localStorage.removeItem("user"),this.currentUserSubject.next(null),this.router.navigate(["/auth/signin"])}getUserProfile(){let t=localStorage.getItem("user");return t?(t=t.replace(/^"|"$/g,""),console.log(t),this.http.get(`http://localhost:8080/utilisateurs/${t}`)):s("User ID not found in local storage")}};r.\u0275fac=function(e){return new(e||r)(c(p),c(g))},r.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();export{U as a};
